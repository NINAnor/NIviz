<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Other figures | NIviz</title>
<meta name="author" content="Chloé Nater, Anders Kolstad, Matthew Grainger, Markus Fjelstad Israelsen">
<meta name="description" content="This final chapter presents a range of other figures and charts that may help with improving the display of key information on the website.  5.1 Gradient density plots for interactive maps The...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="Chapter 5 Other figures | NIviz">
<meta property="og:type" content="book">
<meta property="og:description" content="This final chapter presents a range of other figures and charts that may help with improving the display of key information on the website.  5.1 Gradient density plots for interactive maps The...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Other figures | NIviz">
<meta name="twitter:description" content="This final chapter presents a range of other figures and charts that may help with improving the display of key information on the website.  5.1 Gradient density plots for interactive maps The...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.26/datatables.js"></script><link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/Leaflet.Sync-0.0.5/L.Map.Sync.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">NIviz</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="downloading-and-preparing-example-data.html"><span class="header-section-number">2</span> Downloading and preparing example data</a></li>
<li><a class="" href="cross.html"><span class="header-section-number">3</span> Time series</a></li>
<li><a class="" href="maps-1.html"><span class="header-section-number">4</span> Maps</a></li>
<li><a class="active" href="other-figures.html"><span class="header-section-number">5</span> Other figures</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/NINAnor/NIviz">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="other-figures" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Other figures<a class="anchor" aria-label="anchor" href="#other-figures"><i class="fas fa-link"></i></a>
</h1>
<p>This final chapter presents a range of other figures and charts that may help with improving the display of key information on the website.</p>
<div id="densities" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Gradient density plots for interactive maps<a class="anchor" aria-label="anchor" href="#densities"><i class="fas fa-link"></i></a>
</h2>
<p>The maps presented on the webpage do not include any representation of uncertainty. One way of including that information without having to add additional (layers to the) maps would be to build on the interactive functions included so far and present a probability distribution for the given region and year. This could be displayed in the same box that currently appears when hovering over an area and displays area name and average indicator value.</p>
<p>To make these density plots, we use the previously simulated bootstrap samples, using Jerv as an example:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="st">"Jerv"</span></span>
<span><span class="va">bootStrp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/"</span>, <span class="va">i</span>, <span class="st">"_bootstrapped_scaled.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bootStrp</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 x 4</span></span>
<span><span class="co">#&gt;   ICunitID ICunitName      year  scaledIndicator</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;           &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 1302     Rovviltregion 8 1990            0.194</span></span>
<span><span class="co">#&gt; 2 1302     Rovviltregion 8 1990            0.233</span></span>
<span><span class="co">#&gt; 3 1302     Rovviltregion 8 1990            0.190</span></span>
<span><span class="co">#&gt; 4 1302     Rovviltregion 8 1990            0.207</span></span>
<span><span class="co">#&gt; 5 1302     Rovviltregion 8 1990            0.199</span></span>
<span><span class="co">#&gt; 6 1302     Rovviltregion 8 1990            0.164</span></span></code></pre></div>
<p>We have considered forcing all indicator values &gt; 1 to display as 1, but this messes up when plotting density functions. Still, this conversion is required for calculating the point estimate (median) and we therefore make a copy of the data in which no values are larger than 1.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootStrp1</span> <span class="op">&lt;-</span> <span class="va">bootStrp</span></span>
<span><span class="va">bootStrp1</span><span class="op">$</span><span class="va">scaledIndicator</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">bootStrp1</span><span class="op">$</span><span class="va">scaledIndicator</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
<p>Next, we need to manually calculate the probability densities for the indicator values in each year and area. This is necessary for making density plots with a color gradient fill (but see further below for an alternative using the “ggridges” package which does not require this intermediate step).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">bootStrp</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span><span class="va">areas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">bootStrp</span><span class="op">$</span><span class="va">ICunitName</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pDens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">years</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="va">areas</span><span class="op">)</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">bootStrp_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">bootStrp</span>, <span class="va">year</span> <span class="op">==</span> <span class="va">t</span> <span class="op">&amp;</span> <span class="va">ICunitName</span> <span class="op">==</span> <span class="va">a</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">pDens_a_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>      ICunitName <span class="op">=</span> <span class="va">a</span>,</span>
<span>      year <span class="op">=</span> <span class="va">t</span>, </span>
<span>      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">bootStrp_sub</span><span class="op">$</span><span class="va">scaledIndicator</span><span class="op">)</span><span class="op">$</span><span class="va">x</span>,</span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/density.html">density</a></span><span class="op">(</span><span class="va">bootStrp_sub</span><span class="op">$</span><span class="va">scaledIndicator</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">pDens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">pDens</span>, <span class="va">pDens_a_t</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can then proceed to plotting the probability density functions with a color gradient under the line:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set maximum value (we will not plot beyond 4)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">years</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Take data subsets for a given year</span></span>
<span>  <span class="va">bootStrp_yr</span> <span class="op">&lt;-</span> <span class="va">bootStrp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">bootStrp</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">t</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">bootStrp1_yr</span> <span class="op">&lt;-</span> <span class="va">bootStrp1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">bootStrp1</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">t</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">pDens_yr</span> <span class="op">&lt;-</span> <span class="va">pDens</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pDens</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">t</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Extract distribution medians</span></span>
<span>  <span class="va">sum_values</span> <span class="op">&lt;-</span> <span class="va">bootStrp1_yr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">ICunitName</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>sumStat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">scaledIndicator</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># Set maximum plotting value (never &gt; 5) and mapping for custom color scale</span></span>
<span>  <span class="va">maxVal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pDens_yr</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pDens_yr</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">maxVal</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">+</span><span class="fl">1</span><span class="op">/</span><span class="fl">9</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">valuesMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">colorMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1F8C81"</span>, <span class="va">NIviz_colours</span><span class="op">$</span><span class="va">IndMap_cols</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">valuesMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">maxVal</span><span class="op">)</span><span class="op">/</span><span class="va">maxVal</span><span class="op">)</span></span>
<span>    <span class="va">colorMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1F8C81"</span>, <span class="va">NIviz_colours</span><span class="op">$</span><span class="va">IndMap_cols</span>, <span class="st">"#4B4BAF"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Plot densities</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">pDens_yr</span>, <span class="va">x</span> <span class="op">&lt;=</span> <span class="va">maxVal</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">x</span>, yend <span class="op">=</span> <span class="fl">0</span>, colour <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="co">#scale_color_NIviz_c(name = "IndMap_cols") + </span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_colour_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">colorMap</span>,</span>
<span>                             values <span class="op">=</span> <span class="va">valuesMap</span>,</span>
<span>                             limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">maxVal</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">maxVal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">" ("</span>, <span class="va">t</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Value"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sum_values</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">sumStat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">ICunitName</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>            legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="NIviz_files/figure-html/unnamed-chunk-30-1.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-30-2.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-30-3.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-30-4.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-30-5.png" width="672"></p>
<p>Gradient density plots might also be useful for other types of visualization of indicator and index data. For example, there is a very attractive way of using ridgeplots for visualizing time series inclusing uncertainty. Could look something like this:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="va">areas</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Take data subsets for a given area</span></span>
<span>  <span class="va">bootStrp_ar</span> <span class="op">&lt;-</span> <span class="va">bootStrp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">bootStrp</span><span class="op">$</span><span class="va">ICunitName</span> <span class="op">==</span> <span class="va">a</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">pDens_ar</span> <span class="op">&lt;-</span> <span class="va">pDens</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">pDens</span><span class="op">$</span><span class="va">ICunitName</span> <span class="op">==</span> <span class="va">a</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Set maximum plotting value (never &gt; 5) and mapping for custom color scale</span></span>
<span>  <span class="va">maxVal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pDens_ar</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">5</span>, <span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pDens_ar</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">maxVal</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">+</span><span class="fl">1</span><span class="op">/</span><span class="fl">9</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">valuesMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">colorMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1F8C81"</span>, <span class="va">NIviz_colours</span><span class="op">$</span><span class="va">IndMap_cols</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="va">valuesMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">maxVal</span><span class="op">)</span><span class="op">/</span><span class="va">maxVal</span><span class="op">)</span></span>
<span>    <span class="va">colorMap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#1F8C81"</span>, <span class="va">NIviz_colours</span><span class="op">$</span><span class="va">IndMap_cols</span>, <span class="st">"#4B4BAF"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Plot densities</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">bootStrp_ar</span>, <span class="va">scaledIndicator</span> <span class="op">&lt;=</span> <span class="va">maxVal</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scaledIndicator</span>, y <span class="op">=</span> <span class="va">year</span>, fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_density_ridges_gradient</span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">5</span>, rel_min_height <span class="op">=</span> <span class="fl">0.01</span>, quantile_lines <span class="op">=</span> <span class="cn">TRUE</span>, quantiles <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">colorMap</span>,</span>
<span>                         values <span class="op">=</span> <span class="va">valuesMap</span>,</span>
<span>                         limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.02</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">maxVal</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">maxVal</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">" ("</span>, <span class="va">a</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Scaled indicator value"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.grid.major.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: `stat(x)` was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; i Please use `after_stat(x)` instead.</span></span>
<span><span class="co">#&gt; Picking joint bandwidth of 0.00457</span></span>
<span><span class="co">#&gt; Warning: Using the `size` aesthietic with geom_segment was</span></span>
<span><span class="co">#&gt; deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; i Please use the `linewidth` aesthetic instead.</span></span></code></pre></div>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-31-1.png" width="672"></div>
<pre><code>#&gt; Picking joint bandwidth of 0.00947</code></pre>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-31-2.png" width="672"></div>
<pre><code>#&gt; Picking joint bandwidth of 0.00715</code></pre>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-31-3.png" width="672"></div>
<pre><code>#&gt; Picking joint bandwidth of 0.00184</code></pre>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-31-4.png" width="672"></div>
<pre><code>#&gt; Picking joint bandwidth of 0.00215</code></pre>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-31-5.png" width="672"></div>
<pre><code>#&gt; Picking joint bandwidth of 0.0101</code></pre>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-31-6.png" width="672"></div>
<pre><code>#&gt; Picking joint bandwidth of 0.00966</code></pre>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-31-7.png" width="672"></div>
<pre><code>#&gt; Picking joint bandwidth of 0.0112</code></pre>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-31-8.png" width="672"></div>
</div>
<div id="ecosystem-fidelity" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Ecosystem fidelity<a class="anchor" aria-label="anchor" href="#ecosystem-fidelity"><i class="fas fa-link"></i></a>
</h2>
<p>All indicators are assigned to at least one ecosystem, but a fair number of them are assigned to multiple ecosystems by means of proportions. Wolverine (Jerv), for example, is assigned with 25% to forest and and 75% to mountain. This basic information could easily be displayed on each indicator’s page on naturindeks.no.</p>
<p>The relevant information is found in the assembled indicator data under $indicators:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="st">"jerv"</span></span>
<span><span class="va">indexData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/"</span>, <span class="va">i</span>, <span class="st">"_assemebled.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">indexData</span><span class="op">$</span><span class="va">indicators</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1 obs. of  9 variables:</span></span>
<span><span class="co">#&gt;  $ id               : num 88</span></span>
<span><span class="co">#&gt;  $ name             : chr "Jerv"</span></span>
<span><span class="co">#&gt;  $ keyElement       : logi FALSE</span></span>
<span><span class="co">#&gt;  $ functionalGroup  : chr "Topp-predator generalist"</span></span>
<span><span class="co">#&gt;  $ functionalGroupId: num 8</span></span>
<span><span class="co">#&gt;  $ scalingModel     : chr "Low"</span></span>
<span><span class="co">#&gt;  $ scalingModelId   : num 1</span></span>
<span><span class="co">#&gt;  $ Fjell            : num 75</span></span>
<span><span class="co">#&gt;  $ Skog             : num 25</span></span></code></pre></div>
<p>Any ecosystem type relevant to a specific indicator appears as a separate column in this dataframe, and contains a value representing the % fidelity to that ecosystem type.</p>
<p>Using separately stored information on available ecosystem types, we can assemble this data for all of our example indicators:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load ecosystem info</span></span>
<span><span class="va">EcoSysInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/EcosystemInfo.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Indicator list</span></span>
<span><span class="va">indicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Dikesoldogg"</span>,</span>
<span>               <span class="st">"Jerv"</span>,</span>
<span>               <span class="st">"Elg"</span>,</span>
<span>               <span class="st">"Lomvi"</span>,</span>
<span>               <span class="st">"Havørn"</span>,</span>
<span>               <span class="st">"Lange"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assemble fidelity data</span></span>
<span><span class="va">fidData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">indexData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/"</span>, <span class="va">indicator</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_assemebled.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">ColIdx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">indexData</span><span class="op">$</span><span class="va">indicators</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">EcoSysInfo</span><span class="op">$</span><span class="va">ecosystem</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">fidDataI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    indicator <span class="op">=</span> <span class="va">indicator</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    ecosystem <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">indexData</span><span class="op">$</span><span class="va">indicators</span><span class="op">)</span><span class="op">[</span><span class="va">ColIdx</span><span class="op">]</span>,</span>
<span>    fidelity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">indexData</span><span class="op">$</span><span class="va">indicators</span><span class="op">[</span>,<span class="va">ColIdx</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fidData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">fidData</span>, <span class="va">fidDataI</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This gives us a dataframe with all indicators and their fidelity to different ecosystems:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fidData</span><span class="op">)</span></span>
<span><span class="co">#&gt;     indicator         ecosystem fidelity</span></span>
<span><span class="co">#&gt; 1 Dikesoldogg           Våtmark      100</span></span>
<span><span class="co">#&gt; 2        Jerv             Fjell       75</span></span>
<span><span class="co">#&gt; 3        Jerv              Skog       25</span></span>
<span><span class="co">#&gt; 4         Elg              Skog      100</span></span>
<span><span class="co">#&gt; 5       Lomvi      Hav-pelagisk       67</span></span>
<span><span class="co">#&gt; 6       Lomvi Kystvann-pelagisk       33</span></span>
<span><span class="co">#&gt; 7      Havørn Kystvann-pelagisk      100</span></span>
<span><span class="co">#&gt; 8       Lange           Havbunn       80</span></span>
<span><span class="co">#&gt; 9       Lange     Kystvann-bunn       20</span></span></code></pre></div>
<p>Before plotting, we match the integer ecosystem IDs to make sure the colour mapping works correctly:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fidData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">fidData</span>, <span class="va">EcoSysInfo</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Next, we’ll visualize this information for each indicator by means of pie charts.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EcoSys_cols</span> <span class="op">&lt;-</span> <span class="va">NIviz_colours</span><span class="op">$</span><span class="va">EcoSys_cols</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">EcoSys_cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">EcoSysInfo</span><span class="op">$</span><span class="va">ecosystem</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sub_fidData</span> <span class="op">&lt;-</span> <span class="va">fidData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fidData</span><span class="op">$</span><span class="va">indicator</span> <span class="op">==</span> <span class="va">indicator</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sub_fidData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">fidelity</span>, fill <span class="op">=</span> <span class="fu">fct_inorder</span><span class="op">(</span><span class="va">ecosystem</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">fidelity</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_stack.html">position_stack</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Økosystem"</span>, values <span class="op">=</span> <span class="va">EcoSys_cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">EcoSys_cols</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sub_fidData</span><span class="op">$</span><span class="va">ecosystem</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="NIviz_files/figure-html/unnamed-chunk-36-1.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-36-2.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-36-3.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-36-4.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-36-5.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-36-6.png" width="672">
Depending on how large these pie charts should appear on the website in the end, it may be necessary to move the percentage labels outside the pies. Doing that is a bit more cumbersome, but works with the code below unless the indicator belongs 100 % to one dataset. When that is the case, the solution below does not print the percentage label at all (see indicator Lange) and we have not figured out how to fix that yet.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">sub_fidData</span> <span class="op">&lt;-</span> <span class="va">fidData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">fidData</span><span class="op">$</span><span class="va">indicator</span> <span class="op">==</span> <span class="va">indicator</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">posData</span> <span class="op">&lt;-</span> <span class="va">sub_fidData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>csum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">fidelity</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         pos <span class="op">=</span> <span class="va">fidelity</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fu">lead</span><span class="op">(</span><span class="va">csum</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>         pos <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span>, <span class="va">fidelity</span><span class="op">/</span><span class="fl">2</span>, <span class="va">pos</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sub_fidData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">fidelity</span>, fill <span class="op">=</span> <span class="va">ecosystem</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">indicator</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co">#scale_fill_manual(values = EcoSys_cols) + </span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Økosystem"</span>, values <span class="op">=</span> <span class="va">EcoSys_cols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">EcoSys_cols</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">sub_fidData</span><span class="op">$</span><span class="va">ecosystem</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">posData</span><span class="op">$</span><span class="va">pos</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">sub_fidData</span><span class="op">$</span><span class="va">fidelity</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, </span>
<span>          panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="NIviz_files/figure-html/unnamed-chunk-37-1.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-37-2.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-37-3.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-37-4.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-37-5.png" width="672"><img src="NIviz_files/figure-html/unnamed-chunk-37-6.png" width="672"></p>
</div>
<div id="impact-factor-wordclouds" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Impact factor wordclouds<a class="anchor" aria-label="anchor" href="#impact-factor-wordclouds"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://blog.fellstat.com/?cat=11">wordcloud</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">NIcalc</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lchiffon/wordcloud2">wordcloud2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tm.r-forge.r-project.org/">tm</a></span><span class="op">)</span></span></code></pre></div>
<p>As per now, the website shows the most important impact factors for each indicator as a list in a pop-up window on the top-right. This is information that is likely of great interest to the general public, and would benefit from being placed more visible on the website and in a more engaging way than as a list. One attractive alternative way of presenting is via wordclouds.</p>
<p>The following wordcloud figures show the pressure factors for each indicator, where both the color saturation and text size represent the importance of each pressure factor. Small text size and low saturation means low importance, while large text size represent pressure factors with high importance to the indicator.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="other-figures.html#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="other-figures.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dataset</span></span>
<span id="cb44-3"><a href="other-figures.html#cb44-3" aria-hidden="true" tabindex="-1"></a>pressure <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">"P:/41201612_naturindeks_2021_2023_database_og_innsynslosning/Pilot_Forbedring_Innsynsløsning/R/Indikator_paavirkning.xlsx"</span>)</span>
<span id="cb44-4"><a href="other-figures.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="other-figures.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for species of interest</span></span>
<span id="cb44-6"><a href="other-figures.html#cb44-6" aria-hidden="true" tabindex="-1"></a>pressure <span class="ot">=</span> pressure <span class="sc">%&gt;%</span> <span class="fu">filter</span>(navn_norsk <span class="sc">==</span> <span class="st">"Elg"</span> <span class="sc">|</span> navn_norsk <span class="sc">==</span> <span class="st">"Dikesoldogg"</span> <span class="sc">|</span> navn_norsk <span class="sc">==</span> <span class="st">"Havørn"</span> <span class="sc">|</span> navn_norsk <span class="sc">==</span> <span class="st">"Lange"</span> <span class="sc">|</span> navn_norsk <span class="sc">==</span> <span class="st">"Jerv"</span> <span class="sc">|</span> navn_norsk <span class="sc">==</span> <span class="st">"Lomvi"</span>) <span class="co"># NB - Jerv was not included in the provided excel file</span></span>
<span id="cb44-7"><a href="other-figures.html#cb44-7" aria-hidden="true" tabindex="-1"></a>pressure <span class="ot">=</span> <span class="fu">arrange</span>(pressure, <span class="at">by =</span> navn_norsk)</span>
<span id="cb44-8"><a href="other-figures.html#cb44-8" aria-hidden="true" tabindex="-1"></a>pressure <span class="ot">=</span> pressure <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">PressureFactor =</span> Paavirkningsfaktor, <span class="at">PressureValue =</span> FK_PaavirkningsverdiID)</span>
<span id="cb44-9"><a href="other-figures.html#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="other-figures.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove all instances of "Ikke rel/ukjent" category" and increase the value of pressure factors for better contrast in wordcloud figures</span></span>
<span id="cb44-11"><a href="other-figures.html#cb44-11" aria-hidden="true" tabindex="-1"></a>pressure <span class="ot">=</span> pressure <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PressureValue <span class="sc">!=</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">PressureValue =</span> PressureValue<span class="sc">*</span><span class="dv">2</span>) </span>
<span id="cb44-12"><a href="other-figures.html#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="other-figures.html#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create separate datasets for the different species</span></span>
<span id="cb44-14"><a href="other-figures.html#cb44-14" aria-hidden="true" tabindex="-1"></a>dikesoldogg <span class="ot">=</span> pressure <span class="sc">%&gt;%</span> <span class="fu">filter</span>(navn_norsk <span class="sc">==</span> <span class="st">"Dikesoldogg"</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(PressureFactor, PressureValue)</span>
<span id="cb44-15"><a href="other-figures.html#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="other-figures.html#cb44-16" aria-hidden="true" tabindex="-1"></a>elg <span class="ot">=</span> pressure <span class="sc">%&gt;%</span> <span class="fu">filter</span>(navn_norsk <span class="sc">==</span> <span class="st">"Elg"</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(PressureFactor, PressureValue)</span>
<span id="cb44-17"><a href="other-figures.html#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="other-figures.html#cb44-18" aria-hidden="true" tabindex="-1"></a>havørn <span class="ot">=</span> pressure <span class="sc">%&gt;%</span> <span class="fu">filter</span>(navn_norsk <span class="sc">==</span> <span class="st">"Havørn"</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(PressureFactor, PressureValue)</span>
<span id="cb44-19"><a href="other-figures.html#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="other-figures.html#cb44-20" aria-hidden="true" tabindex="-1"></a>lange <span class="ot">=</span> pressure <span class="sc">%&gt;%</span> <span class="fu">filter</span>(navn_norsk <span class="sc">==</span> <span class="st">"Lange"</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(PressureFactor, PressureValue)</span>
<span id="cb44-21"><a href="other-figures.html#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="other-figures.html#cb44-22" aria-hidden="true" tabindex="-1"></a>lomvi <span class="ot">=</span> pressure <span class="sc">%&gt;%</span> <span class="fu">filter</span>(navn_norsk <span class="sc">==</span> <span class="st">"Lomvi"</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(PressureFactor, PressureValue)</span>
<span id="cb44-23"><a href="other-figures.html#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="other-figures.html#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a custom color gradient (green in this case)</span></span>
<span id="cb44-25"><a href="other-figures.html#cb44-25" aria-hidden="true" tabindex="-1"></a>pressureColors <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#bde4aa"</span>, <span class="st">"#addb9d"</span>, <span class="st">"#9cd28f"</span>, <span class="st">"#8cc982"</span>, <span class="st">"#7dc275"</span>, <span class="st">"#6cb967"</span>, <span class="st">"#5db15a"</span>, <span class="st">"#50a54e"</span>, <span class="st">"#479845"</span>, <span class="st">"#3f8c3b"</span>, <span class="st">"#367e31"</span>, <span class="st">"#2e7228"</span>, <span class="st">"#25661f"</span>) </span></code></pre></div>
<div id="dikesoldogg-oblong-leaved-sundew" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> Dikesoldogg (oblong-leaved sundew)<a class="anchor" aria-label="anchor" href="#dikesoldogg-oblong-leaved-sundew"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Dikesoldogg</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud/man/wordcloud.html">wordcloud</a></span><span class="op">(</span>words <span class="op">=</span> <span class="va">dikesoldogg</span><span class="op">$</span><span class="va">PressureFactor</span>, freq <span class="op">=</span> <span class="va">dikesoldogg</span><span class="op">$</span><span class="va">PressureValue</span>, min.freq <span class="op">=</span> <span class="fl">1</span>, max.words <span class="op">=</span> <span class="fl">200</span>, random.order <span class="op">=</span> <span class="cn">FALSE</span>, rot.per <span class="op">=</span> <span class="fl">0.35</span>, colors <span class="op">=</span> <span class="va">pressureColors</span>, scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="co"># use rot.per to set the percentage of words that are at a 90 degree angle</span></span></code></pre></div>
<div class="inline-figure"><img src="NIviz_files/figure-html/Wordcloud%20-%20Dikesoldogg-1.png" width="672"></div>
</div>
<div id="elg-moose" class="section level3" number="5.3.2">
<h3>
<span class="header-section-number">5.3.2</span> Elg (Moose)<a class="anchor" aria-label="anchor" href="#elg-moose"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud/man/wordcloud.html">wordcloud</a></span><span class="op">(</span>words <span class="op">=</span> <span class="va">elg</span><span class="op">$</span><span class="va">PressureFactor</span>, freq <span class="op">=</span> <span class="va">elg</span><span class="op">$</span><span class="va">PressureValue</span>, min.freq <span class="op">=</span> <span class="fl">1</span>, max.words <span class="op">=</span> <span class="fl">200</span>, random.order <span class="op">=</span> <span class="cn">FALSE</span>, rot.per <span class="op">=</span> <span class="fl">0.35</span>, colors <span class="op">=</span> <span class="va">pressureColors</span>, scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="NIviz_files/figure-html/Wordcloud%20-%20Elg-1.png" width="672"></div>
</div>
<div id="havørn-white-tailed-eagle" class="section level3" number="5.3.3">
<h3>
<span class="header-section-number">5.3.3</span> Havørn (White-tailed eagle)<a class="anchor" aria-label="anchor" href="#hav%C3%B8rn-white-tailed-eagle"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="other-figures.html#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="other-figures.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(<span class="at">words =</span> havørn<span class="sc">$</span>PressureFactor, <span class="at">freq =</span> havørn<span class="sc">$</span>PressureValue, <span class="at">min.freq =</span> <span class="dv">1</span>, <span class="at">max.words =</span> <span class="dv">200</span>, <span class="at">random.order =</span> <span class="cn">FALSE</span>, <span class="at">rot.per =</span> <span class="fl">0.35</span>, <span class="at">colors =</span> pressureColors, <span class="at">scale =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">0.5</span>))</span></code></pre></div>
<div class="inline-figure"><img src="NIviz_files/figure-html/Wordcloud%20-%20Hav%C3%B8rn-1.png" width="672"></div>
</div>
<div id="lange-common-ling" class="section level3" number="5.3.4">
<h3>
<span class="header-section-number">5.3.4</span> Lange (Common ling)<a class="anchor" aria-label="anchor" href="#lange-common-ling"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud/man/wordcloud.html">wordcloud</a></span><span class="op">(</span>words <span class="op">=</span> <span class="va">lange</span><span class="op">$</span><span class="va">PressureFactor</span>, freq <span class="op">=</span> <span class="va">lange</span><span class="op">$</span><span class="va">PressureValue</span>, min.freq <span class="op">=</span> <span class="fl">1</span>, max.words <span class="op">=</span> <span class="fl">200</span>, random.order <span class="op">=</span> <span class="cn">FALSE</span>, rot.per <span class="op">=</span> <span class="fl">0.35</span>, colors <span class="op">=</span> <span class="va">pressureColors</span>, scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="NIviz_files/figure-html/Wordcloud%20-%20Lange-1.png" width="672"></div>
</div>
<div id="lomvi-common-guillemot" class="section level3" number="5.3.5">
<h3>
<span class="header-section-number">5.3.5</span> Lomvi (common guillemot)<a class="anchor" aria-label="anchor" href="#lomvi-common-guillemot"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/wordcloud/man/wordcloud.html">wordcloud</a></span><span class="op">(</span>words <span class="op">=</span> <span class="va">lomvi</span><span class="op">$</span><span class="va">PressureFactor</span>, freq <span class="op">=</span> <span class="va">lomvi</span><span class="op">$</span><span class="va">PressureValue</span>, min.freq <span class="op">=</span> <span class="fl">1</span>, max.words <span class="op">=</span> <span class="fl">200</span>, random.order <span class="op">=</span> <span class="cn">FALSE</span>, rot.per <span class="op">=</span> <span class="fl">0.35</span>, colors <span class="op">=</span> <span class="va">pressureColors</span>, scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="NIviz_files/figure-html/Wordcloud%20-%20Lomvi-1.png" width="672"></div>
</div>
</div>
<div id="data-type" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Data type<a class="anchor" aria-label="anchor" href="#data-type"><i class="fas fa-link"></i></a>
</h2>
<p>For data type, pie charts can also be a good option for visualization. The same would also hold for other pieces of key information that are not currently displayed, such as the proportion of imputed data points.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"R/colorPalettes.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Elg datatyper</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  category<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ekspert"</span>, </span>
<span>             <span class="st">"Modeller"</span>, </span>
<span>             <span class="st">"Overvåkning"</span><span class="op">)</span>,</span>
<span>  count<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4.9</span>, <span class="fl">95.1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co"># Compute percentages</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">fraction</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">count</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the cumulative percentages (top of each rectangle)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">fraction</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute the bottom of each rectangle</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">ymin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">ymax</span>, n<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute label position</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">labelPosition</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">ymax</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">ymin</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">labelPosition</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">&lt;-</span><span class="fl">0.8</span></span>
<span><span class="co"># Compute a good label</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">category</span>, <span class="st">"\n "</span>, <span class="va">data</span><span class="op">$</span><span class="va">count</span>, <span class="st">" %"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'ggrepel' was built under R version 4.1.3</span></span>
<span><span class="co"># Make the plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymax<span class="op">=</span><span class="va">ymax</span>, ymin<span class="op">=</span><span class="va">ymin</span>, xmax<span class="op">=</span><span class="fl">4</span>, xmin<span class="op">=</span><span class="fl">3</span>, fill<span class="op">=</span><span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">labelPosition</span>, label<span class="op">=</span><span class="va">label</span>, color<span class="op">=</span><span class="va">category</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span> <span class="co"># x here controls label position (inner / outer)</span></span>
<span>  <span class="fu">scale_fill_NIviz_d</span><span class="op">(</span><span class="st">"IndMap_cols"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_NIviz_d</span><span class="op">(</span><span class="st">"IndMap_cols"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span><span class="op">(</span>theta<span class="op">=</span><span class="st">"y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="NIviz_files/figure-html/unnamed-chunk-39-1.png" width="672"></div>
</div>
<div id="weights" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Weights<a class="anchor" aria-label="anchor" href="#weights"><i class="fas fa-link"></i></a>
</h2>
<p>Finally, today’s website also does not present the indicator- or area-weights, even though they are absolutely central in the calculation of spatially aggregated indicators and indices.
Visualization of indicator weights for indices (Nature Index for different ecosystems and thematic indices) are routinely made during the updating of the Nature Index and can be found in the reports (e.g. Figure <a href="other-figures.html#fig:NIWeights">5.1</a>). It might also be worth considering to make information on weighting at different levels available. This could, for example, include the area weights applied when making both composite indices and averaged indicators, or the weights given to any specific indicator in the Nature Index for different ecosystems and for different thematic indices.</p>
<div class="figure">
<span style="display:block;" id="fig:NIWeights"></span>
<img src="images/NI_weights.png" alt="Indicator weights for the Nature Index for mountains, as presented in the Nature Index report." width="80%"><p class="caption">
Figure 5.1: Indicator weights for the Nature Index for mountains, as presented in the Nature Index report.
</p>
</div>

<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-kubivcek2011" class="csl-entry">
Kubı́ček, Petr, and Čeněk Šašinka. <span>“Thematic Uncertainty Visualization Usability–Comparison of Basic Methods.”</span> <em>Annals of GIS</em> 17, no. 4 (2011): 253–63.
</div>
<div id="ref-lucchesi2017" class="csl-entry">
Lucchesi, Lydia R, and Christopher K Wikle. <span>“Visualizing Uncertainty in Areal Data with Bivariate Choropleth Maps, Map Pixelation and Glyph Rotation.”</span> <em>Stat</em> 6, no. 1 (2017): 292–302.
</div>
<div id="ref-maceachren2012" class="csl-entry">
MacEachren, Alan M, Robert E Roth, James O’Brien, Bonan Li, Derek Swingley, and Mark Gahegan. <span>“Visual Semiotics &amp; Uncertainty Visualization: An Empirical Study.”</span> <em>IEEE Transactions on Visualization and Computer Graphics</em> 18, no. 12 (2012): 2496–2505.
</div>
</div>
</div>
</div>









  <div class="chapter-nav">
<div class="prev"><a href="maps-1.html"><span class="header-section-number">4</span> Maps</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#other-figures"><span class="header-section-number">5</span> Other figures</a></li>
<li><a class="nav-link" href="#densities"><span class="header-section-number">5.1</span> Gradient density plots for interactive maps</a></li>
<li><a class="nav-link" href="#ecosystem-fidelity"><span class="header-section-number">5.2</span> Ecosystem fidelity</a></li>
<li>
<a class="nav-link" href="#impact-factor-wordclouds"><span class="header-section-number">5.3</span> Impact factor wordclouds</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#dikesoldogg-oblong-leaved-sundew"><span class="header-section-number">5.3.1</span> Dikesoldogg (oblong-leaved sundew)</a></li>
<li><a class="nav-link" href="#elg-moose"><span class="header-section-number">5.3.2</span> Elg (Moose)</a></li>
<li><a class="nav-link" href="#hav%C3%B8rn-white-tailed-eagle"><span class="header-section-number">5.3.3</span> Havørn (White-tailed eagle)</a></li>
<li><a class="nav-link" href="#lange-common-ling"><span class="header-section-number">5.3.4</span> Lange (Common ling)</a></li>
<li><a class="nav-link" href="#lomvi-common-guillemot"><span class="header-section-number">5.3.5</span> Lomvi (common guillemot)</a></li>
</ul>
</li>
<li><a class="nav-link" href="#data-type"><span class="header-section-number">5.4</span> Data type</a></li>
<li><a class="nav-link" href="#weights"><span class="header-section-number">5.5</span> Weights</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/NINAnor/NIviz/blob/master/04-other_figures.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/NINAnor/NIviz/edit/master/04-other_figures.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>NIviz</strong>" was written by Chloé Nater, Anders Kolstad, Matthew Grainger, Markus Fjelstad Israelsen. It was last built on 2022-11-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
