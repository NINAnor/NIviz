<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Maps | NIvis</title>
<meta name="description" content="4.1 Raw data   4.2 Scaled data  4.2.1 Jerv  4.2.1.1 Prepare NI data The jerv (wolverine) data was downloaded using the R/singleIndicator.R script and the importDatasetApi() function,, and...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Chapter 4 Maps | NIvis">
<meta property="og:type" content="book">
<meta property="og:description" content="4.1 Raw data   4.2 Scaled data  4.2.1 Jerv  4.2.1.1 Prepare NI data The jerv (wolverine) data was downloaded using the R/singleIndicator.R script and the importDatasetApi() function,, and...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Maps | NIvis">
<meta name="twitter:description" content="4.1 Raw data   4.2 Scaled data  4.2.1 Jerv  4.2.1.1 Prepare NI data The jerv (wolverine) data was downloaded using the R/singleIndicator.R script and the importDatasetApi() function,, and...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">NIvis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="downloading-and-preparing-example-data.html"><span class="header-section-number">2</span> Downloading and preparing example data</a></li>
<li><a class="" href="cross.html"><span class="header-section-number">3</span> Time series</a></li>
<li><a class="active" href="maps.html"><span class="header-section-number">4</span> Maps</a></li>
<li><a class="" href="other-figures.html"><span class="header-section-number">5</span> Other figures</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/NINAnor/NIviz">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="maps" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Maps<a class="anchor" aria-label="anchor" href="#maps"><i class="fas fa-link"></i></a>
</h1>
<div id="raw-data-1" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Raw data<a class="anchor" aria-label="anchor" href="#raw-data-1"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="scaled-data-1" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Scaled data<a class="anchor" aria-label="anchor" href="#scaled-data-1"><i class="fas fa-link"></i></a>
</h2>
<div id="jerv" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> Jerv<a class="anchor" aria-label="anchor" href="#jerv"><i class="fas fa-link"></i></a>
</h3>
<div id="prepare-ni-data" class="section level4" number="4.2.1.1">
<h4>
<span class="header-section-number">4.2.1.1</span> Prepare NI data<a class="anchor" aria-label="anchor" href="#prepare-ni-data"><i class="fas fa-link"></i></a>
</h4>
<p>The jerv (wolverine) data was downloaded using the <code>R/singleIndicator.R</code> script and the importDatasetApi() function,, and subsequently the assembleNiObject() function, so now I can simply import it.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jerv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/Jerv_assemebled.rds"</span><span class="op">)</span></span></code></pre></div>
<p>This data file contains the raw data in the form of expected values for each BSunits (municipalities). But we actually want to keep the original geometeris of the eight rovviltregioner, and so we need to focus in the ICunits instead.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">$</span><span class="va">`2019`</span><span class="op">$</span><span class="va">expectedValue</span>,</span>
<span>        names.arg <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">$</span><span class="va">`2019`</span><span class="op">$</span><span class="va">ICunitName</span>, </span>
<span>        las<span class="op">=</span><span class="fl">2</span>,</span>
<span>        ylab <span class="op">=</span> <span class="st">"Estimated number of\nwolverine in 2019"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-maps_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<p>The data also contains upper and lower quantiles, but we can also get the full probability distribution and sample from it to get standard deviations.
but also as probability functions that we can sample from:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># bruker tradOb siden custumDist er NA. Dette er ikke en generisk l√∏sning. </span></span>
<span><span class="va">obstype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"tradObs"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">$</span><span class="st">'2019'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#myYears &lt;- as.character(c(1990,2000,2010,2014,2019))</span></span>
<span><span class="va">myYears</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">myYears</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="co"># print(i)</span></span>
<span></span>
<span><span class="va">myMat</span> <span class="op">&lt;-</span> <span class="fu">NIcalc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/NIcalc/man/sampleObsMat.html">sampleObsMat</a></span><span class="op">(</span></span>
<span>  ICunitId           <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ICunitId</span>, </span>
<span>  value              <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expectedValue</span>,</span>
<span>  distrib            <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">distributionFamilyName</span>,</span>
<span>  mu                 <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">distParameter1</span>,</span>
<span>  sig                <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">distParameter2</span>,</span>
<span>  customDistribution <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">customDistribution</span>,</span>
<span>          obsType <span class="op">=</span> <span class="va">obstype</span>,</span>
<span>          nsim <span class="op">=</span> <span class="fl">1000</span></span>
<span>          </span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"myMat"</span>, <span class="va">myYears</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="va">myMat</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'distr::plot' by</span></span>
<span><span class="co">#&gt; 'graphics::plot' when loading 'NIcalc'</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">myMat2019</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, main <span class="op">=</span> <span class="st">"Rovviltregion 1"</span>, xlab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">myMat2019</span><span class="op">[</span><span class="fl">8</span>,<span class="op">]</span>, main <span class="op">=</span> <span class="st">"Rovviltregion 8"</span>, xlab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-maps_files/figure-html/unnamed-chunk-4-1.png" width="672"></div>
<p>For some reason the extected values are far from the mean of these distributions. I did this exercise <a href="https://ninanor.github.io/IBECA/jerv.html">once before</a>, and did not get this problem then. I think the difference is that I use eco = NULL this time, in the <code><a href="https://rdrr.io/pkg/NIcalc/man/importDatasetApi.html">importDatasetApi()</a></code>, and this cause the output to somehow split into forest and alpine ecosystems. I will ignore this here for this example.</p>
<p>I can also get the reference values in the same way, and then divide one by the other to get scaled values</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMatr</span> <span class="op">&lt;-</span> <span class="fu">NIcalc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/NIcalc/man/sampleObsMat.html">sampleObsMat</a></span><span class="op">(</span></span>
<span>            <span class="va">jerv</span><span class="op">$</span><span class="va">referenceValues</span><span class="op">$</span><span class="va">ICunitId</span>, </span>
<span>            <span class="va">jerv</span><span class="op">$</span><span class="va">referenceValues</span><span class="op">$</span><span class="va">expectedValue</span>,</span>
<span>            <span class="va">jerv</span><span class="op">$</span><span class="va">referenceValues</span><span class="op">$</span><span class="va">distributionFamilyName</span>,</span>
<span>            mu <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">referenceValues</span><span class="op">$</span><span class="va">distParameter1</span>,</span>
<span>            sig <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">referenceValues</span><span class="op">$</span><span class="va">distParameter2</span>,</span>
<span>            customDistribution <span class="op">=</span> <span class="va">jerv</span><span class="op">$</span><span class="va">referenceValues</span><span class="op">$</span><span class="va">customDistribution</span>,</span>
<span>            obsType <span class="op">=</span> <span class="va">obstype</span>,</span>
<span>            nsim <span class="op">=</span><span class="fl">1000</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">myMat2019</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">myMatr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="03-maps_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<p>Then I will create a data frame with the mean indicator values and the SD.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/matrixStats">matrixStats</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'matrixStats' was built under R version</span></span>
<span><span class="co">#&gt; 4.1.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'matrixStats'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     count</span></span>
<span><span class="va">jerv_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"raw2019"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">myMat2019</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                       <span class="st">"sd2019"</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">matrixStats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/matrixStats/man/rowSds.html">rowSds</a></span><span class="op">(</span><span class="va">myMat2019</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                       <span class="st">"ref"</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span><span class="op">(</span><span class="va">myMatr</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">jerv_tbl</span><span class="op">$</span><span class="va">scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">jerv_tbl</span><span class="op">$</span><span class="va">raw2019</span><span class="op">/</span><span class="va">jerv_tbl</span><span class="op">$</span><span class="va">ref</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">jerv_tbl</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">jerv_tbl</span><span class="op">$</span><span class="va">sd2019</span><span class="op">/</span><span class="va">jerv_tbl</span><span class="op">$</span><span class="va">raw2019</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">jerv_tbl</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="va">jerv</span><span class="op">$</span><span class="va">indicatorValues</span><span class="op">$</span><span class="va">`2019`</span><span class="op">$</span><span class="va">ICunitName</span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">jerv_tbl</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-f3325c2188fd59024620" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f3325c2188fd59024620">{"x":{"filter":"none","vertical":false,"data":[["1302","1304","1305","1311","1313","1315","1316","5141"],[163.12,60.36,13.99,4.18,2.93,6.9,3.43,3.64],[23.31,22.67,23.57,13.6,7.33,22.7,9.77,8.15],[838.1,351.82,407.23,279.7,204.75,192.34,165.12,28.11],[0.19,0.17,0.03,0.01,0.01,0.04,0.02,0.13],[0.14,0.38,1.68,3.25,2.5,3.29,2.85,2.24],["Rovviltregion 8","Rovviltregion 7","Rovviltregion 6","Rovviltregion 1","Rovviltregion 2","Rovviltregion 3","Rovviltregion 5","Rovviltregion 4"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>raw2019<\/th>\n      <th>sd2019<\/th>\n      <th>ref<\/th>\n      <th>scaled<\/th>\n      <th>cv<\/th>\n      <th>region<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>This is a special case maybe, because the sd is often larger than the mean.</p>
<p>Btw, we could use inbuilt NIcalc functions to get the indicator value, like I do below, but that will aggregate to regions, and we want to keep the original geometry.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jervComp</span> <span class="op">&lt;-</span> <span class="fu">NIcalc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/NIcalc/man/calculateIndex.html">calculateIndex</a></span><span class="op">(</span></span>
<span>  x       <span class="op">=</span> <span class="va">jerv</span>,</span>
<span>  nsim     <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  awBSunit <span class="op">=</span> <span class="st">"terrestrialArea"</span>,</span>
<span>  fids     <span class="op">=</span> <span class="cn">F</span>,    <span class="co"># should fidelities be ignored in </span></span>
<span>                   <span class="co"># the calculation of Wi?</span></span>
<span>  tgroups  <span class="op">=</span> <span class="cn">F</span>, <span class="co"># should grouping of indicators </span></span>
<span>                   <span class="co"># into trophic and key indicator </span></span>
<span>                   <span class="co"># groups be ignored</span></span>
<span>  keys     <span class="op">=</span> <span class="st">"specialWeight"</span>, <span class="co">#"ignore",</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Indices for NIunits 'wholeArea', 'E', 'S', 'W', 'C', 'N'</span></span>
<span><span class="co">#&gt; and years '1990', '2000', '2010', '2014', '2019' will be calculated.</span></span>
<span><span class="co">#&gt; The 30 index distributions will each be based on  1000 simulations.</span></span>
<span><span class="co">#&gt; There are 8 ICunits with observations in data set 'jerv'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Calculating weights that are the same for all years .....</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sampling reference values .....</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sampling and scaling indicator observations from  1990 .....</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sampling and scaling indicator observations from  2000 .....</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sampling and scaling indicator observations from  2010 .....</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sampling and scaling indicator observations from  2014 .....</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sampling and scaling indicator observations from  2019 .....</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">jervComp</span><span class="op">$</span><span class="va">wholeArea</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:unnamed-chunk-7"></span>
<img src="03-maps_files/figure-html/unnamed-chunk-7-1.png" alt="The scaled indicator values for wolverine across Norway." width="672"><p class="caption">
Figure 4.1: The scaled indicator values for wolverine across Norway.
</p>
</div>
</div>
<div id="get-geometries" class="section level4" number="4.2.1.2">
<h4>
<span class="header-section-number">4.2.1.2</span> Get geometries<a class="anchor" aria-label="anchor" href="#get-geometries"><i class="fas fa-link"></i></a>
</h4>
<p>Then I can get the spatial geometries associated with the data. There are the so called rovviltregioner. There are eight of them. They are actually linked to the BS-units (municipalites), but we don‚Äôt want to plot the outlines of the municipalities.
The geometries for the appropriate spatial units of each indicator can be downloaded in .json format via a previously created API for the nature index database: <a href="https://ninweb08.nina.no/NaturindeksAPI/index.html" class="uri">https://ninweb08.nina.no/NaturindeksAPI/index.html</a>
To get the file for a specific indicator, one needs to enter the numerical indicator id under ‚Äú/api/Indicator/{id}/Areas‚Äù and then click download. We then converted the .json file to shapefiles for use in R.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"P:/41201612_naturindeks_2021_2023_database_og_innsynslosning/Pilot_Forbedring_Innsynsl√∏sning/Shapefiles/Jerv"</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'sf' was built under R version 4.1.3</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 7.2.1; sf_use_s2() is TRUE</span></span>
<span><span class="va">rov</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">rov</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html">st_make_valid</a></span><span class="op">(</span><span class="va">rov</span><span class="op">)</span></span>
<span><span class="va">rov</span> <span class="op">&lt;-</span> <span class="va">rov</span><span class="op">[</span><span class="va">rov</span><span class="op">$</span><span class="va">area</span><span class="op">!=</span><span class="st">"DEF jerv"</span>,<span class="op">]</span></span></code></pre></div>
<p>Clip it against the outline of Norway to make it look more pretty</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"data/outlineOfNorway_EPSG25833.shp"</span></span>
<span><span class="va">nor</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">nor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">nor</span>, crs<span class="op">=</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">rov</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_intersection</a></span><span class="op">(</span><span class="va">rov</span>, <span class="va">nor</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially</span></span>
<span><span class="co">#&gt; constant throughout all geometries</span></span></code></pre></div>
</div>
<div id="link-data-and-geometries" class="section level4" number="4.2.1.3">
<h4>
<span class="header-section-number">4.2.1.3</span> Link data and geometries<a class="anchor" aria-label="anchor" href="#link-data-and-geometries"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rov</span><span class="op">$</span><span class="va">scaledIndicator</span> <span class="op">&lt;-</span> <span class="va">jerv_tbl</span><span class="op">$</span><span class="va">scaled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">rov</span><span class="op">$</span><span class="va">area</span>, <span class="va">jerv_tbl</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">rov</span><span class="op">$</span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="va">jerv_tbl</span><span class="op">$</span><span class="va">cv</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">rov</span><span class="op">$</span><span class="va">area</span>, <span class="va">jerv_tbl</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">rov</span><span class="op">$</span><span class="va">raw</span> <span class="op">&lt;-</span> <span class="va">jerv_tbl</span><span class="op">$</span><span class="va">raw2019</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">rov</span><span class="op">$</span><span class="va">area</span>, <span class="va">jerv_tbl</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap">tmap</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'tmap' was built under R version 4.1.3</span></span>
<span><span class="va">one</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">rov</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"scaledIndicator"</span>, </span>
<span>              border.col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">two</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">rov</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"cv"</span>, </span>
<span>              border.col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">three</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">rov</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"raw"</span>, </span>
<span>              border.col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_arrange.html">tmap_arrange</a></span><span class="op">(</span><span class="va">one</span>, <span class="va">two</span>, </span>
<span>             widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.75</span>, <span class="fl">.25</span><span class="op">)</span>,</span>
<span>             heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Legend labels were too wide. The labels have been resized to 0.52, 0.52, 0.52, 0.52, 0.52, 0.52, 0.52. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</span></span></code></pre></div>
<div class="inline-figure"><img src="03-maps_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>

</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="cross.html"><span class="header-section-number">3</span> Time series</a></div>
<div class="next"><a href="other-figures.html"><span class="header-section-number">5</span> Other figures</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#maps"><span class="header-section-number">4</span> Maps</a></li>
<li><a class="nav-link" href="#raw-data-1"><span class="header-section-number">4.1</span> Raw data</a></li>
<li>
<a class="nav-link" href="#scaled-data-1"><span class="header-section-number">4.2</span> Scaled data</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#jerv"><span class="header-section-number">4.2.1</span> Jerv</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/NINAnor/NIviz/blob/master/03-maps.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/NINAnor/NIviz/edit/master/03-maps.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>NIvis</strong>" was written by . It was last built on 2022-10-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
